(function(){var e=[],m=!1,p=/(?:(\w+\:))?(?:\/\/(?:[^@]*@)?([^\/:\?#]+)(?::([0-9]+))?)?([^\?#]*)(?:(\?[^#]+)|\?)?(?:(#.*))?/,h=function(a,c,f){a.attachEvent?a.attachEvent("on"+c,f):a.addEventListener(c,f,!1)},l=!!history.pushState,q="onhashchange"in window,g=function(a){var c=location.protocol+"//"+location.hostname;location.port&&(c+=":"+location.port);a=a.replace(c,"");l||(a=encodeURIComponent(a));return a},n=function(){var a;l?a=location.pathname+location.search:(a=location.hash.substr(1))?("!"==
a.substr(0,1)&&(a=a.substr(1)),a=decodeURIComponent(a)):a=location.pathname+location.search;return a},k=function(){var a=n();if(e.length)for(var c=-1,f=e.length;++c<f;e[c].call(null,a));window.MetaphorJs&&MetaphorJs.trigger("locationchange",a)};h(window,"load",function(){m=!0});history.initPushState=function(){if(l)history.origPushState=history.pushState,history.origReplaceState=history.replaceState,h(window,"popstate",k),history.pushState=function(a,d,b){history.origPushState(a,d,g(b));k()},history.replaceState=
function(a,d,b){history.origReplaceState(a,d,g(b));k()};else if(q)history.replaceState=history.pushState=function(a,d,b){a=g(b);location.hash=a?"!"+a:""},h(window,"hashchange",k);else{var a=null,c=!1;window.onIframeHistoryChange=function(a){c||(location.hash=a?"!"+a:"",k())};var f=function(r){var d=a.contentWindow.document;d.open();d.write("<html><head><title>"+document.title+'</title><script type="text/javascript">var hashValue = "'+r+'";window.top.onIframeHistoryChange(hashValue);\x3c/script></head><body>&nbsp;</body></html>');
d.close()};history.pushState=function(a,d,b){f(g(b))};history.replaceState=function(c,d,b){c=g(b);a.contentWindow.hashValue=c};var e=function(){a=document.createElement("iframe");a.src="about:blank";a.style.display="none";document.body.appendChild(a);c=!0;f(g(location.hash.substr(1)));c=!1};m?e():h(window,"load",e)}h(document.documentElement,"click",function(a){a=a||window.event;for(var d=a.target||a.srcElement,b;d&&"a"!=d.nodeName.toLowerCase();)d=d.parentNode;if(d){b=d.getAttribute("href");var c;
if(c=b&&"#"!=b.substr(0,1))b=b.match(p),c=b[1]&&location.protocol!=b[1]||b[2]&&location.hostname!=b[2]?!1:b[2]||b[3]?location.port!=b[3]?!1:!0:!0;if(c&&!d.getAttribute("target"))return history.pushState(null,null,d.getAttribute("href")),a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation(),!1}});history.initPushState=function(){}};window.MetaphorJs?(MetaphorJs.pushUrl=function(a){history.pushState(null,null,a)},MetaphorJs.replaceUrl=function(a){history.replaceState(null,null,
a)},MetaphorJs.currentUrl=function(){return n()}):history.onchange=function(a){e.push(a)}})();
