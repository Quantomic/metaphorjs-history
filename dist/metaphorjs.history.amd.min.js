'use strict';define("metaphorjs-history",["metaphorjs-observable"],function(G){function s(){return!1}function t(){return!0}function n(a){return"object"==typeof a&&3===H(a)&&!a.nodeType&&a.constructor===Object}function z(a){return!0===a||!1===a}function I(){}function C(a,b,c,d){return setTimeout(function(){a.apply(b,c||[])},d||0)}var D=Array.prototype.slice,J=Object.prototype.toString,H=function(){var a={"[object String]":0,"[object Number]":1,"[object Boolean]":2,"[object Object]":3,"[object Function]":4,
"[object Array]":5,"[object RegExp]":9,"[object Date]":10};return function(b){if(!b){if(null===b)return 6;if(void 0===b)return 7}var c=a[J.call(b)];return void 0===c?-1:1==c&&isNaN(b)?8:c}}(),q=function(){return function b(){var c=!1,d=!1,f=D.call(arguments),h=f.shift(),e,l,g;z(f[f.length-1])&&(c=f.pop());z(f[f.length-1])&&(d=c,c=f.pop());for(;f.length;)if(e=f.shift())for(l in e)if(e.hasOwnProperty(l)&&void 0!==(g=e[l]))if(d)if(h[l]&&n(h[l])&&n(g))b(h[l],g,c,d);else{if(!0===c||void 0==h[l])n(g)?(h[l]=
{},b(h[l],g,c,!0)):h[l]=g}else if(!0===c||void 0==h[l])h[l]=g;return h}}(),v=function(a){if(a instanceof v)return a;if(!(this instanceof v))return new v(a);for(var b in a)if(!this[b])try{this[b]=a[b]}catch(c){}this.originalEvent=a;this.type=a.type;!this.target&&a.srcElement&&(this.target=a.srcElement);var d,f=a.button;void 0===this.pageX&&null!==a.clientX&&(d=this.target?this.target.ownerDocument||window.document:window.document,b=d.documentElement,d=d.body,this.pageX=a.clientX+(b&&b.scrollLeft||
d&&d.scrollLeft||0)-(b&&b.clientLeft||d&&d.clientLeft||0),this.pageY=a.clientY+(b&&b.scrollTop||d&&d.scrollTop||0)-(b&&b.clientTop||d&&d.clientTop||0));this.which||void 0===f||(this.which=f&1?1:f&2?3:f&4?2:0);this.isDefaultPrevented=a.defaultPrevented||void 0===a.defaultPrevented&&!1===a.returnValue?t:s;this.timeStamp=a&&a.timeStamp||(new Date).getTime()};q(v.prototype,{isDefaultPrevented:s,isPropagationStopped:s,isImmediatePropagationStopped:s,preventDefault:function(){var a=this.originalEvent;this.isDefaultPrevented=
t;a.returnValue=!1;a&&a.preventDefault&&a.preventDefault()},stopPropagation:function(){var a=this.originalEvent;this.isPropagationStopped=t;a&&a.stopPropagation&&a.stopPropagation()},stopImmediatePropagation:function(){var a=this.originalEvent;this.isImmediatePropagationStopped=t;a&&a.stopImmediatePropagation&&a.stopImmediatePropagation();this.stopPropagation()}},!0,!1);var E=function(a){function b(){d=null}var c,d;a=function(a){return function(h){var e=new v(h||window.event),l=D.call(arguments,1),
g=0,m=0,k=0,p=0,q=0,r=0;e.type="mousewheel";"detail"in e&&(k=-1*e.detail);"wheelDelta"in e&&(k=e.wheelDelta);"wheelDeltaY"in e&&(k=e.wheelDeltaY);"wheelDeltaX"in e&&(m=-1*e.wheelDeltaX);"axis"in e&&e.axis===e.HORIZONTAL_AXIS&&(m=-1*k,k=0);g=0===k?m:k;"deltaY"in e&&(g=k=-1*e.deltaY);"deltaX"in e&&(m=e.deltaX,0===k&&(g=-1*m));if(0!==k||0!==m){p=Math.max(Math.abs(k),Math.abs(m));if(!d||p<d)d=p,"mousewheel"===e.type&&0===p%120&&(d/=40);"mousewheel"===e.type&&0===p%120&&(g/=40,m/=40,k/=40);g=Math[1<=g?
"floor":"ceil"](g/d);m=Math[1<=m?"floor":"ceil"](m/d);k=Math[1<=k?"floor":"ceil"](k/d);this.getBoundingClientRect&&(p=this.getBoundingClientRect(),q=e.clientX-p.left,r=e.clientY-p.top);e.deltaX=m;e.deltaY=k;e.deltaFactor=d;e.offsetX=q;e.offsetY=r;e.deltaMode=0;l.unshift(e,g,m,k);c&&clearTimeout(c);c=setTimeout(b,200);return a.apply(this,l)}}};a.events=function(){var a=window.document;return"onwheel"in a||9<=a.documentMode?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"]};return a}(),
A=function(){var a=null,b=null;return function(c,d,f){null===a&&(a=c.attachEvent?"attachEvent":"addEventListener",b=c.attachEvent?"on":"");if("mousewheel"==d){f=E(f);d=E.events();var h,e;h=0;for(e=d.length;h<e;h++)c[a](b+d[h],f,!1)}else c[a](b+d,f,!1);return f}}(),K=/^(((([^:\/#\?]+:)?(?:(\/\/)((?:(([^:@\/#\?]+)(?:\:([^:@\/#\?]+))?)@)?(([^:\/#\?\]\[]+|\[[^\/\]@#?]+\])(?:\:([0-9]+))?))?)?)?((\/?(?:[^\/\?#]+\/+)*)([^\?#]*)))?(\?[^#]+)?)(#.*)?/,w=function(a){var b=a.match(K)||[],c=("undefined"!=typeof window?
window.location:null)||{};return{protocol:b[4]||c.protocol||"http:",hostname:b[11]||c.hostname||"",host:(b[11]||"")+(b[12]?":"+b[12]:"")||c.host||"",username:b[8]||c.username||"",password:b[9]||c.password||"",port:parseInt(b[12],10)||c.port||"",href:a,path:(b[13]||"/")+(b[16]||""),pathname:b[13]||"/",search:b[16]||"",hash:b[17]&&"#"!=b[17]?b[17]:""}},x=function(a,b){var c="";b=b||{};b.onlyPath||(c+=a.protocol+"//",a.username&&a.password&&(c+=a.username+":"+a.password+"@"),c+=a.hostname,a.hostname&&
a.port&&(c+=":"+a.port));b.onlyHost||(c+=a.pathname||"/",a.search&&"?"!=a.search&&(c+=a.search),a.hash&&"#"!=a.hash&&(c+=a.hash));return c};return function(){var a,b,c,d=new G,f,h,e="undefined"==typeof window,l=null,g,m,k;d.createEvent("before-location-change",!1);var p=function(a,c){"string"==typeof a&&(a=w(a));"string"==typeof c&&(c=w(c));var b=["protocol","host","port"],d,e,f;d=0;for(e=b.length;d<e;d++)if(f=b[d],a[f]&&c[f]&&a[f]!=c[f])return!0;return!1},s=function(a,c){"string"==typeof a&&(a=w(a));
"string"==typeof c&&(c=w(c));return p(a,c)||a.pathname!=c.pathname||a.search!=c.search||a.hash!=c.hash},r=function(a){a=w(a);if(!g||k)a.hash="#!"+encodeURIComponent(a.path),a.pathname="/",a.search="";return x(a,{onlyPath:!0})},t=function(a){c.hash=a?"!"+a:""},n=function(){var a,b;g?a=x(c):(a=c.hash.substr(1),b=q({},c,!0,!1),a&&("!"==a.substr(0,1)&&(a=a.substr(1)),a=decodeURIComponent(a).split("?"),b.pathname=a[0],b.search=a[1]?"?"+a[1]:""),a=x(b));return a},z=function(a){l=q({},c,!0,!1);u("location-change",
a)},B=function(){if(s(l,c)){var a=n();l=q({},c,!0,!1);u("location-change",a)}},u=function(a,c){var b=c||n();return d.trigger(a,b)},y=function(){a=window;b=a.history;c=a.location;g=!!b.pushState;m="onhashchange"in a;k=g&&(navigator.vendor||"").match(/Opera/);l=q({},c,!0,!1);if(g)A(a,"popstate",B),f=function(a){if(!1===u("before-location-change",a))return!1;b.pushState(null,null,r(a));z(a)},h=function(a){if(!1===u("before-location-change",a))return!1;b.replaceState(null,null,r(a));z(a)};else if(m)h=
f=function(a){if(!1===u("before-location-change",a))return!1;C(t,null,[r(a)])},A(a,"hashchange",B);else{var d=null,n=!1;a.onIframeHistoryChange=function(a){n||C(function(){t(a);B()})};var F=function(a){var c=d.contentWindow.document;c.open();c.write("<html><head><title>"+document.title+'</title><script type="text/javascript">var hashValue = "'+a+'";window.top.onIframeHistoryChange(hashValue);\x3c/script></head><body>&nbsp;</body></html>');c.close()};f=function(a){if(!1===u("before-location-change",
a))return!1;F(r(a))};h=function(a){if(!1===u("before-location-change",a))return!1;a=r(a);d.contentWindow.hashValue=a};var x=function(){d=window.document.createElement("iframe");d.src="about:blank";d.style.display="none";window.document.body.appendChild(d);n=!0;F(r(c.hash.substr(1)));n=!1};e?x():A(a,"load",x)}A(window.document.documentElement,"click",function(b){b=new v(b||a.event);for(var d=b.target,e;d&&"a"!=d.nodeName.toLowerCase();)d=d.parentNode;if(d&&!b.isDefaultPrevented()){e=d.getAttribute?
d.getAttribute("href"):null;if("#"==e)return b.preventDefault(),b.stopPropagation(),!1;if(e&&"#"!=e.substr(0,1)&&(!d.getAttribute||!d.getAttribute("target"))){var d=q({},c,!0,!1),g=w(e);if(p(d,g))return null;s(d,g)&&f(e);b.preventDefault();b.stopPropagation();return!1}}return null});y=I};A(window,"load",function(){e=!0});return q({},d.getApi(),{push:function(a){y();b.pushState(null,null,a)},replace:function(a){y();b.replaceState(null,null,a)},current:function(){y();return n()},init:function(){return y()},
polyfill:function(){y();window.history.pushState=function(a,c,b){f(b)};window.history.replaceState=function(a,c,b){h(b)}}})}()});
