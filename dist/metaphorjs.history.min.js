'use strict';(function(){function w(a,b,c){a.attachEvent?a.attachEvent("on"+b,c):a.addEventListener(b,c,!1)}function p(){return!1}function m(){return!0}function s(a){return"object"==typeof a&&3===E(a)&&!a.nodeType&&a.constructor===Object}function A(a){return!0===a||!1===a}function F(){}function B(a,b,c,d){setTimeout(function(){a.apply(b,c||[])},d||0)}var n=Array.prototype.slice,G=Object.prototype.toString,E=function(){var a={"[object String]":0,"[object Number]":1,"[object Boolean]":2,"[object Object]":3,
"[object Function]":4,"[object Array]":5,"[object RegExp]":9,"[object Date]":10};return function(b){if(!b){if(null===b)return 6;if(void 0===b)return 7}var c=a[G.call(b)];return void 0===c?-1:1==c&&isNaN(b)?8:c}}(),q=function(){return function b(){var c=!1,d=!1,e=n.call(arguments),f=e.shift(),g,h,k;A(e[e.length-1])&&(c=e.pop());A(e[e.length-1])&&(d=c,c=e.pop());for(;e.length;)if(g=e.shift())for(h in g)if(g.hasOwnProperty(h)&&void 0!==(k=g[h]))if(d)if(f[h]&&s(f[h])&&s(k))b(f[h],k,c,d);else{if(!0===
c||void 0==f[h])s(k)?(f[h]={},b(f[h],k,c,!0)):f[h]=k}else if(!0===c||void 0==f[h])f[h]=k;return f}}(),x=function(a){if(a instanceof x)return a;if(!(this instanceof x))return new x(a);for(var b in a)if(!this[b])try{this[b]=a[b]}catch(c){}this.originalEvent=a;this.type=a.type;!this.target&&a.srcElement&&(this.target=a.srcElement);var d,e=a.button;void 0===this.pageX&&null!==a.clientX&&(d=this.target?this.target.ownerDocument||window.document:window.document,b=d.documentElement,d=d.body,this.pageX=a.clientX+
(b&&b.scrollLeft||d&&d.scrollLeft||0)-(b&&b.clientLeft||d&&d.clientLeft||0),this.pageY=a.clientY+(b&&b.scrollTop||d&&d.scrollTop||0)-(b&&b.clientTop||d&&d.clientTop||0));this.which||void 0===e||(this.which=e&1?1:e&2?3:e&4?2:0);this.isDefaultPrevented=a.defaultPrevented||void 0===a.defaultPrevented&&!1===a.returnValue?m:p;this.timeStamp=a&&a.timeStamp||(new Date).getTime()};q(x.prototype,{isDefaultPrevented:p,isPropagationStopped:p,isImmediatePropagationStopped:p,preventDefault:function(){var a=this.originalEvent;
this.isDefaultPrevented=m;a.returnValue=!1;a&&a.preventDefault&&a.preventDefault()},stopPropagation:function(){var a=this.originalEvent;this.isPropagationStopped=m;a&&a.stopPropagation&&a.stopPropagation()},stopImmediatePropagation:function(){var a=this.originalEvent;this.isImmediatePropagationStopped=m;a&&a.stopImmediatePropagation&&a.stopImmediatePropagation();this.stopPropagation()}},!0,!1);var H=function(){var a=["0","0","0"];return function(){for(var b=a.length,c;b;){b--;c=a[b].charCodeAt(0);
if(57==c)return a[b]="A",a.join("");if(90==c)a[b]="0";else return a[b]=String.fromCharCode(c+1),a.join("")}a.unshift("0");return a.join("")}}(),I=Function.prototype.bind?function(a,b){return a.bind(b)}:function(a,b){return function(){return a.apply(b,arguments)}},C=function(){this.events={}};q(C.prototype,{createEvent:function(a,b){a=a.toLowerCase();var c=this.events;c[a]||(c[a]=new l(a,b));return c[a]},getEvent:function(a){a=a.toLowerCase();return this.events[a]},on:function(a,b,c,d){a=a.toLowerCase();
var e=this.events;e[a]||(e[a]=new l(a));return e[a].on(b,c,d)},once:function(a,b,c,d){d=d||{};d.limit=1;return this.on(a,b,c,d)},un:function(a,b,c){a=a.toLowerCase();var d=this.events;d[a]&&d[a].un(b,c)},hasListener:function(a,b,c){a=a.toLowerCase();var d=this.events;return d[a]?d[a].hasListener(b,c):!1},removeAllListeners:function(a){var b=this.events;b[a]&&b[a].removeAllListeners()},trigger:function(){var a=arguments[0],b=this.events,a=a.toLowerCase();if(!b[a])return null;a=b[a];return a.trigger.apply(a,
n.call(arguments,1))},suspendEvent:function(a){a=a.toLowerCase();var b=this.events;b[a]&&b[a].suspend()},suspendAllEvents:function(){var a=this.events,b;for(b in a)a[b].suspend()},resumeEvent:function(a){a=a.toLowerCase();var b=this.events;b[a]&&b[a].resume()},resumeAllEvents:function(){var a=this.events,b;for(b in a)a[b].resume()},destroyEvent:function(a){var b=this.events;b[a]&&(b[a].removeAllListeners(),b[a].destroy(),delete b[a])},destroy:function(a){var b=this.events;if(a)a=a.toLowerCase(),b[a]&&
(b[a].destroy(),delete b[a]);else{for(var c in b)b[c].destroy();this.events={}}},getApi:function(){if(!this.api){for(var a="createEvent getEvent on un once hasListener removeAllListeners trigger suspendEvent suspendAllEvents resumeEvent resumeAllEvents destroyEvent".split(" "),b={},c,d=-1,e=a.length;++d<e;c=a[d],b[c]=I(this[c],this));this.api=b}return this.api}},!0,!1);var l=function(a,b){this.name=a;this.listeners=[];this.map={};this.hash=H();this.uni="$$"+a+"_"+this.hash;this.suspended=!1;this.lid=
0;this.returnResult=void 0===b?null:b};q(l.prototype,{getName:function(){return this.name},destroy:function(){this.map=this.listeners=null},on:function(a,b,c){if(!a)return null;b=b||null;c=c||{};var d=this.uni,e=b||a;if(e[d]&&!c.allowDupes)return null;var f=++this.lid,g=c.first||!1;e[d]=f;a={fn:a,context:b,uniContext:e,id:f,called:0,limit:c.limit||0,start:c.start||1,count:0,append:c.append,prepend:c.prepend};g?this.listeners.unshift(a):this.listeners.push(a);this.map[f]=a;return f},once:function(a,
b,c){c=c||{};c.once=!0;return this.on(a,b,c)},un:function(a,b){var c=-1,d=this.uni,e=this.listeners,f;f=a==parseInt(a)?a:(b||a)[d];if(!f)return!1;for(var g=0,h=e.length;g<h;g++)if(e[g].id==f){c=g;delete e[g].uniContext[d];break}if(-1==c)return!1;e.splice(c,1);delete this.map[f];return!0},hasListener:function(a,b){var c=this.listeners,d;if(a){d="function"!=typeof a?a:(b||a)[this.uni];if(!d)return!1;for(var e=0,f=c.length;e<f;e++)if(c[e].id==d)return!0;return!1}return 0<c.length},removeAllListeners:function(){var a=
this.listeners,b=this.uni,c,d;c=0;for(d=a.length;c<d;c++)delete a[c].uniContext[b];this.listeners=[];this.map={}},suspend:function(){this.suspended=!0},resume:function(){this.suspended=!1},_prepareArgs:function(a,b){var c;a.append||a.prepend?(c=n.call(b),a.prepend&&(c=a.prepend.concat(c)),a.append&&(c=c.concat(a.append))):c=b;return c},trigger:function(){var a=this.listeners,b=this.returnResult;if(this.suspended||0==a.length)return null;for(var c="all"==b||"merge"==b?[]:null,d,e,a="first"==b?[a[0]]:
n.call(a);d=a.shift();)if(d&&this.map[d.id]&&(d.count++,!(d.count<d.start)))if(e=d.fn.apply(d.context,this._prepareArgs(d,arguments)),d.called++,d.called==d.limit&&this.un(d.id),"all"==b)c.push(e);else if("merge"==b&&e)c=c.concat(e);else{if("first"==b)return e;if("last"==b)c=e;else if(!1==b&&!1===e)return!1}if(b)return c}},!0,!1);var D=function(){var a={};return function(b){return a[b]||(a[b]=new RegExp(b))}}(),J=function(){var a,b,c,d=new C,e={},f,g,h="undefined"==typeof window,k=/(?:(\w+:))?(?:\/\/(?:[^@]*@)?([^\/:\?#]+)(?::([0-9]+))?)?([^\?#]*)(?:(\?[^#]+)|\?)?(?:(#.*))?/,
t,p,m;d.createEvent("beforeLocationChange",!1);var u=function(a){var b=c.protocol+"//"+c.hostname;c.port&&(b+=":"+c.port);a=a.replace(b,"");t||(a=encodeURIComponent(a));"?"==a.substr(0,1)&&(a=c.pathname+a);m&&(a=a.replace("?","#"));return a},n=function(a){a=(""+a).match(k);var b,c;if(!t||m)c=a[6],"!"==c.substr(0,1)&&(b=c.substr(1));b||(b=a[4],a[5]&&(b+=a[5]));return b},s=function(a){c.hash=a?"!"+a:""},z=function(){var a;t?a=c.pathname+c.search+c.hash:(a=c.hash.substr(1))?("!"==a.substr(0,1)&&(a=a.substr(1)),
a=decodeURIComponent(a)):a=c.pathname+c.search;return a},l=function(a,b){var c=e[a].extractor;return"function"==typeof c?c(b,a):(c=b.match(c))?c.pop():null},y=function(){var a=z();v("locationChange",a);var b,c,f;for(b in e)c=e[b].value,f=l(b,a),e[b].value=f,f!=c&&d.trigger("change-"+b,f,c,b,a)},v=function(a,b){var c=b||z();return d.trigger(a,c)},r=function(){a=window;b=a.history;c=a.location;t=!!b.pushState;p="onhashchange"in a;m=t&&(navigator.vendor||"").match(/Opera/);if(t)b.origPushState=b.pushState,
b.origReplaceState=b.replaceState,w(a,"popstate",y),f=function(a){if(!1===v("beforeLocationChange",a))return!1;b.origPushState(null,null,u(a));y()},g=function(a){if(!1===v("beforeLocationChange",a))return!1;b.origReplaceState(null,null,u(a));y()};else if(p)g=f=function(a){if(!1===v("beforeLocationChange",a))return!1;B(s,null,[u(a)])},w(a,"hashchange",y);else{var d=null,e=!1;a.onIframeHistoryChange=function(a){e||B(function(){s(a);y()})};var l=function(a){var b=d.contentWindow.document;b.open();b.write("<html><head><title>"+
document.title+'</title><script type="text/javascript">var hashValue = "'+a+'";window.top.onIframeHistoryChange(hashValue);\x3c/script></head><body>&nbsp;</body></html>');b.close()};f=function(a){if(!1===v("beforeLocationChange",a))return!1;l(u(a))};g=function(a){if(!1===v("beforeLocationChange",a))return!1;a=u(a);d.contentWindow.hashValue=a};var q=function(){d=window.document.createElement("iframe");d.src="about:blank";d.style.display="none";window.document.body.appendChild(d);e=!0;l(u(c.hash.substr(1)));
e=!1};h?q():w(a,"load",q)}w(window.document.documentElement,"click",function(d){d=new x(d||a.event);for(var e=d.target,f;e&&"a"!=e.nodeName.toLowerCase();)e=e.parentNode;if(e){if(e=(f=e.getAttribute?e.getAttribute("href"):null)&&"#"!=f.substr(0,1)&&(!e.getAttribute||!e.getAttribute("target")))e=f.match(k),e=e[1]&&c.protocol!=e[1]||e[2]&&c.hostname!=e[2]?!1:e[2]||e[3]?c.port==e[3]:!0;if(e&&n(f)!=n(c))return b.pushState(null,null,n(f)),d.preventDefault(),d.stopPropagation(),!1}return null});r=F};w(window,
"load",function(){h=!0});return q({},d.getApi(),{push:function(a){r();b.pushState(null,null,a)},replace:function(a){r();b.replaceState(null,null,a)},current:function(){r();return z()},init:function(){return r()},polyfill:function(){r();window.history.pushState=function(a,b,c){f(c)};window.history.replaceState=function(a,b,c){g(c)}},getParam:function(a){return e[a]?e[a].value:null},addParam:function(a,b){r();e[a]||(b?"function"!=typeof b&&(b="string"==typeof b||b===""+b?D(b):b):b=D(a+"=([^&]+)"),e[a]=
{name:a,value:null,extractor:b},e[a].value=l(a,z()))}})}();MetaphorJs.history=J;"undefined"!=typeof global?global.MetaphorJs=MetaphorJs:window.MetaphorJs=MetaphorJs})();
