(function(){var p={lib:{}},h=function(f,h,l){f.attachEvent?f.attachEvent("on"+h,l):f.addEventListener(h,l,!1)};(function(){var f={locationChange:[],beforeLocationChange:[]},r=!1,l=/(?:(\w+:))?(?:\/\/(?:[^@]*@)?([^\/:\?#]+)(?::([0-9]+))?)?([^\?#]*)(?:(\?[^#]+)|\?)?(?:(#.*))?/,m=!!history.pushState,t="onhashchange"in window,k=function(a){var d=location.protocol+"//"+location.hostname;location.port&&(d+=":"+location.port);a=a.replace(d,"");m||(a=encodeURIComponent(a));return a},q=function(a){a=(""+a).match(l);
var d,g;m||(g=a[6],"!"==g.substr(0,1)&&(d=g.substr(1)));d||(d=a[4],a[5]&&(d+="?"+a[5]));return d},s=function(){var a;m?a=location.pathname+location.search:(a=location.hash.substr(1))?("!"==a.substr(0,1)&&(a=a.substr(1)),a=decodeURIComponent(a)):a=location.pathname+location.search;return a},e=function(a,d,g){g=g||s();for(var e,n=-1,b=f[a].length;++n<b;)if(e=f[a][n].call(null,g),d&&!1===e)return!1;return p.trigger(a,g)};h(window,"load",function(){r=!0});history.initPushState=function(){if(m)history.origPushState=
history.pushState,history.origReplaceState=history.replaceState,h(window,"popstate",function(){e("locationChange")}),history.pushState=function(a,b,c){if(!1===e("beforeLocationChange",!0,c))return!1;history.origPushState(a,b,k(c));e("locationChange")},history.replaceState=function(a,b,c){if(!1===e("beforeLocationChange",!0,c))return!1;history.origReplaceState(a,b,k(c));e("locationChange")};else if(t)history.replaceState=history.pushState=function(a,b,c){if(!1===e("beforeLocationChange",!0,c))return!1;
a=k(c);location.hash=a?"!"+a:""},h(window,"hashchange",function(){e("locationChange")});else{var a=null,d=!1;window.onIframeHistoryChange=function(a){d||(location.hash=a?"!"+a:"",e("locationChange"))};var g=function(n){var b=a.contentWindow.document;b.open();b.write("<html><head><title>"+document.title+'</title><script type="text/javascript">var hashValue = "'+n+'";window.top.onIframeHistoryChange(hashValue);\x3c/script></head><body>&nbsp;</body></html>');b.close()};history.pushState=function(a,b,
c){if(!1===e("beforeLocationChange",!0,c))return!1;g(k(c))};history.replaceState=function(d,b,c){if(!1===e("beforeLocationChange",!0,c))return!1;d=k(c);a.contentWindow.hashValue=d};var f=function(){a=document.createElement("iframe");a.src="about:blank";a.style.display="none";document.body.appendChild(a);d=!0;g(k(location.hash.substr(1)));d=!1};r?f():h(window,"load",f)}h(document.documentElement,"click",function(a){a=a||window.event;for(var b=a.target||a.srcElement,c;b&&"a"!=b.nodeName.toLowerCase();)b=
b.parentNode;if(b){if(b=(c=b.getAttribute("href"))&&"#"!=c.substr(0,1)&&!b.getAttribute("target"))b=c.match(l),b=b[1]&&location.protocol!=b[1]||b[2]&&location.hostname!=b[2]?!1:b[2]||b[3]?location.port==b[3]:!0;if(b&&q(c)!=q(window.location))return history.pushState(null,null,q(c)),a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation(),!1}return null});history.initPushState=function(){}};history.onBeforeChange=function(a){f.beforeLocationChange.push(a)};history.onChange=function(a){f.locationChange.push(a)};
return{pushUrl:function(a){history.pushState(null,null,a)},replaceUrl:function(a){history.replaceState(null,null,a)},currentUrl:function(){return s()}}})();"undefined"!=typeof global?global.MetaphorJs=p:window.MetaphorJs=p})();
