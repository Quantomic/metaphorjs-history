(function(){var t=function(a,b,c){a.attachEvent?a.attachEvent("on"+b,c):a.addEventListener(b,c,!1)},r=function(){return!1},q=function(){return!0},k=function(a){return"undefined"==typeof a},u=function(a){if(a instanceof u)return a;if(!(this instanceof u))return new u(a);for(var b in a)if(!this[b])try{this[b]=a[b]}catch(c){}this.originalEvent=a;this.type=a.type;!this.target&&a.srcElement&&(this.target=a.srcElement);var d,e=a.button;k(this.pageX)&&null!==a.clientX&&(d=this.target?this.target.ownerDocument||
document:document,b=d.documentElement,d=d.body,this.pageX=a.clientX+(b&&b.scrollLeft||d&&d.scrollLeft||0)-(b&&b.clientLeft||d&&d.clientLeft||0),this.pageY=a.clientY+(b&&b.scrollTop||d&&d.scrollTop||0)-(b&&b.clientTop||d&&d.clientTop||0));this.which||void 0===e||(this.which=e&1?1:e&2?3:e&4?2:0);this.isDefaultPrevented=a.defaultPrevented||k(a.defaultPrevented)&&!1===a.returnValue?q:r;this.timeStamp=a&&a.timeStamp||(new Date).getTime()};u.prototype={isDefaultPrevented:r,isPropagationStopped:r,isImmediatePropagationStopped:r,
preventDefault:function(){var a=this.originalEvent;this.isDefaultPrevented=q;a.returnValue=!1;a&&a.preventDefault&&a.preventDefault()},stopPropagation:function(){var a=this.originalEvent;this.isPropagationStopped=q;a&&a.stopPropagation&&a.stopPropagation()},stopImmediatePropagation:function(){var a=this.originalEvent;this.isImmediatePropagationStopped=q;a&&a.stopImmediatePropagation&&a.stopImmediatePropagation();this.stopPropagation()}};var z=function(){var a=["0","0","0"];return function(){for(var b=
a.length,c;b;){b--;c=a[b].charCodeAt(0);if(57==c)return a[b]="A",a.join("");if(90==c)a[b]="0";else return a[b]=String.fromCharCode(c+1),a.join("")}a.unshift("0");return a.join("")}}(),A=Function.prototype.bind?function(a,b){return a.bind(b)}:function(a,b){return function(){return a.apply(b,arguments)}},l=Array.prototype.slice,w=function(){this.events={}};w.prototype={createEvent:function(a,b){a=a.toLowerCase();var c=this.events;c[a]||(c[a]=new p(a,b));return c[a]},getEvent:function(a){a=a.toLowerCase();
return this.events[a]},on:function(a,b,c,d){a=a.toLowerCase();var e=this.events;e[a]||(e[a]=new p(a));return e[a].on(b,c,d)},once:function(a,b,c,d){d=d||{};d.limit=1;return this.on(a,b,c,d)},un:function(a,b,c){a=a.toLowerCase();var d=this.events;d[a]&&d[a].un(b,c)},hasListener:function(a,b,c){a=a.toLowerCase();var d=this.events;return d[a]?d[a].hasListener(b,c):!1},removeAllListeners:function(a){var b=this.events;b[a]&&b[a].removeAllListeners()},trigger:function(){var a=arguments[0],b=this.events,
a=a.toLowerCase();if(!b[a])return null;a=b[a];return a.trigger.apply(a,l.call(arguments,1))},suspendEvent:function(a){a=a.toLowerCase();var b=this.events;b[a]&&b[a].suspend()},suspendAllEvents:function(){var a=this.events,b;for(b in a)a[b].suspend()},resumeEvent:function(a){a=a.toLowerCase();var b=this.events;b[a]&&b[a].resume()},resumeAllEvents:function(){var a=this.events,b;for(b in a)a[b].resume()},destroyEvent:function(a){var b=this.events;b[a]&&(b[a].removeAllListeners(),b[a].destroy(),delete b[a])},
destroy:function(a){var b=this.events;if(a)a=a.toLowerCase(),b[a]&&(b[a].destroy(),delete b[a]);else{for(var c in b)b[c].destroy();this.events={}}},getApi:function(){if(!this.api){for(var a="createEvent getEvent on un once hasListener removeAllListeners trigger suspendEvent suspendAllEvents resumeEvent resumeAllEvents destroyEvent".split(" "),b={},c,d=-1,e=a.length;++d<e;c=a[d],b[c]=A(this[c],this));this.api=b}return this.api}};var p=function(a,b){this.name=a;this.listeners=[];this.map={};this.hash=
z();this.uni="$$"+a+"_"+this.hash;this.suspended=!1;this.lid=0;this.returnResult=k(b)?null:b};p.prototype={getName:function(){return this.name},destroy:function(){this.map=this.listeners=null},on:function(a,b,c){if(!a)return null;b=b||null;c=c||{};var d=this.uni,e=b||a;if(e[d]&&!c.allowDupes)return null;var f=++this.lid,g=c.first||!1;e[d]=f;a={fn:a,scope:b,uniScope:e,id:f,called:0,limit:c.limit||0,start:c.start||1,count:0,append:c.append,prepend:c.prepend};g?this.listeners.unshift(a):this.listeners.push(a);
this.map[f]=a;return f},once:function(a,b,c){c=c||{};c.once=!0;return this.on(a,b,c)},un:function(a,b){var c=-1,d=this.uni,e=this.listeners,f;f=a==parseInt(a)?a:(b||a)[d];if(!f)return!1;for(var g=0,h=e.length;g<h;g++)if(e[g].id==f){c=g;delete e[g].uniScope[d];break}if(-1==c)return!1;e.splice(c,1);delete this.map[f];return!0},hasListener:function(a,b){var c=this.listeners,d;if(a){d="function"!==typeof a?a:(b||a)[this.uni];if(!d)return!1;for(var e=0,f=c.length;e<f;e++)if(c[e].id==d)return!0;return!1}return 0<
c.length},removeAllListeners:function(){var a=this.listeners,b=this.uni,c,d;c=0;for(d=a.length;c<d;c++)delete a[c].uniScope[b];this.listeners=[];this.map={}},suspend:function(){this.suspended=!0},resume:function(){this.suspended=!1},_prepareArgs:function(a,b){var c;a.append||a.prepend?(c=l.call(b),a.prepend&&(c=a.prepend.concat(c)),a.append&&(c=c.concat(a.append))):c=b;return c},trigger:function(){var a=this.listeners,b=this.returnResult;if(this.suspended||0==a.length)return null;for(var c="all"==
b?[]:null,d,e,a="first"==b?[a[0]]:l.call(a);d=a.shift();)if(d&&this.map[d.id]&&(d.count++,!(d.count<d.start))){e=d.fn.apply(d.scope,this._prepareArgs(d,arguments));d.called++;d.called==d.limit&&this.un(d.id);"all"==b&&c.push(e);if("first"==b)return e;"last"==b&&(c=e);if(!1==b&&!1===e)break}if(b)return c}};var v=function(a){return!(!a||a.constructor!==Object)},B=function b(){var c=!1,d=!1,e=l.call(arguments),f=e.shift(),g,h,m;"boolean"==typeof e[e.length-1]&&(c=e.pop());"boolean"==typeof e[e.length-
1]&&(d=c,c=e.pop());for(;e.length;)if(g=e.shift())for(h in g)if(g.hasOwnProperty(h)&&!k(m=g[h]))if(d)if(f[h]&&v(f[h])&&v(m))b(f[h],m,c,d);else{if(!0===c||k(f[h])||null===f[h])v(m)?(f[h]={},b(f[h],m,c,!0)):f[h]=m}else if(!0===c||k(f[h])||null===f[h])f[h]=m;return f},x=function(){},D=function(){var b=window,c=b.history,d=b.location,e=new w,f={},g={locationChange:[],beforeLocationChange:[]},h=!1,m=/(?:(\w+:))?(?:\/\/(?:[^@]*@)?([^\/:\?#]+)(?::([0-9]+))?)?([^\?#]*)(?:(\?[^#]+)|\?)?(?:(#.*))?/,k=!!c.pushState,
r="onhashchange"in b;B(f,e.getApi());var s=function(b){var c=d.protocol+"//"+d.hostname;d.port&&(c+=":"+d.port);b=b.replace(c,"");k||(b=encodeURIComponent(b));return b},q=function(b){b=(""+b).match(m);var c,d;k||(d=b[6],"!"==d.substr(0,1)&&(c=d.substr(1)));c||(c=b[4],b[5]&&(c+="?"+b[5]));return c},l=function(){var b;k?b=d.pathname+d.search:(b=d.hash.substr(1))?("!"==b.substr(0,1)&&(b=b.substr(1)),b=decodeURIComponent(b)):b=d.pathname+d.search;return b},n=function(b,c,d){d=d||l();for(var e,y=-1,C=
g[b].length;++y<C;)if(e=g[b][y].call(null,d),c&&!1===e)return!1;return f.trigger(b,d)},p=function(){if(k)c.origPushState=c.pushState,c.origReplaceState=c.replaceState,t(b,"popstate",function(){n("locationChange")}),c.pushState=function(b,d,e){if(!1===n("beforeLocationChange",!0,e))return!1;c.origPushState(b,d,s(e));n("locationChange")},c.replaceState=function(b,d,e){if(!1===n("beforeLocationChange",!0,e))return!1;c.origReplaceState(b,d,s(e));n("locationChange")};else if(r)c.replaceState=c.pushState=
function(b,c,e){if(!1===n("beforeLocationChange",!0,e))return!1;b=s(e);d.hash=b?"!"+b:""},t(b,"hashchange",function(){n("locationChange")});else{var e=null,g=!1;b.onIframeHistoryChange=function(b){g||(d.hash=b?"!"+b:"",n("locationChange"))};var l=function(b){var c=e.contentWindow.document;c.open();c.write("<html><head><title>"+document.title+'</title><script type="text/javascript">var hashValue = "'+b+'";window.top.onIframeHistoryChange(hashValue);\x3c/script></head><body>&nbsp;</body></html>');c.close()};
c.pushState=function(b,c,d){if(!1===n("beforeLocationChange",!0,d))return!1;l(s(d))};c.replaceState=function(b,c,d){if(!1===n("beforeLocationChange",!0,d))return!1;b=s(d);e.contentWindow.hashValue=b};var p=function(){e=document.createElement("iframe");e.src="about:blank";e.style.display="none";document.body.appendChild(e);g=!0;l(s(d.hash.substr(1)));g=!1};h?p():t(b,"load",p)}t(document.documentElement,"click",function(e){e=new u(e||b.event);for(var f=e.target,g;f&&"a"!=f.nodeName.toLowerCase();)f=
f.parentNode;if(f){if(f=(g=f.getAttribute("href"))&&"#"!=g.substr(0,1)&&!f.getAttribute("target"))f=g.match(m),f=f[1]&&d.protocol!=f[1]||f[2]&&d.hostname!=f[2]?!1:f[2]||f[3]?d.port==f[3]:!0;if(f&&q(g)!=q(d))return c.pushState(null,null,q(g)),e.preventDefault(),e.stopPropagation(),!1}return null});c.initPushState=x;f.initPushState=x};t(b,"load",function(){h=!0});c.initPushState=p;c.onBeforeChange=function(b){g.beforeLocationChange.push(b)};c.onChange=function(b){g.locationChange.push(b)};f.pushUrl=
function(b){c.pushState(null,null,b)};f.replaceUrl=function(b){c.replaceState(null,null,b)};f.currentUrl=function(){return l()};f.initPushState=function(){return p()};return f}();MetaphorJs.history=D;"undefined"!=typeof global?global.MetaphorJs=MetaphorJs:window.MetaphorJs=MetaphorJs})();
