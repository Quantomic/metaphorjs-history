(function(){window.MetaphorJs={lib:{}};var h=MetaphorJs.addListener=function(g,h,l){g.attachEvent?g.attachEvent("on"+h,l):g.addEventListener(h,l,!1)};(function(){var g={locationChange:[],beforeLocationChange:[]},p=!1,l=/(?:(\w+:))?(?:\/\/(?:[^@]*@)?([^\/:\?#]+)(?::([0-9]+))?)?([^\?#]*)(?:(\?[^#]+)|\?)?(?:(#.*))?/,m=!!history.pushState,s="onhashchange"in window,k=function(a){var c=location.protocol+"//"+location.hostname;location.port&&(c+=":"+location.port);a=a.replace(c,"");m||(a=encodeURIComponent(a));
return a},n=function(a){a=(""+a).match(l);var c,f;m||(f=a[6],"!"==f.substr(0,1)&&(c=f.substr(1)));c||(c=a[4],a[5]&&(c+="?"+a[5]));return c},q=function(){var a;m?a=location.pathname+location.search:(a=location.hash.substr(1))?("!"==a.substr(0,1)&&(a=a.substr(1)),a=decodeURIComponent(a)):a=location.pathname+location.search;return a},e=function(a,c,f){f=f||q();for(var e,r=-1,b=g[a].length;++r<b;)if(e=g[a][r].call(null,f),c&&!1===e)return!1;if(window.MetaphorJs){if(c)return MetaphorJs.trigger(a,f);MetaphorJs.triggerAsync(a,
f)}return null};h(window,"load",function(){p=!0});history.initPushState=function(){if(m)history.origPushState=history.pushState,history.origReplaceState=history.replaceState,h(window,"popstate",function(){e("locationChange")}),history.pushState=function(a,b,d){if(!1===e("beforeLocationChange",!0,d))return!1;history.origPushState(a,b,k(d));e("locationChange")},history.replaceState=function(a,b,d){if(!1===e("beforeLocationChange",!0,d))return!1;history.origReplaceState(a,b,k(d));e("locationChange")};
else if(s)history.replaceState=history.pushState=function(a,b,d){if(!1===e("beforeLocationChange",!0,d))return!1;a=k(d);location.hash=a?"!"+a:""},h(window,"hashchange",function(){e("locationChange")});else{var a=null,c=!1;window.onIframeHistoryChange=function(a){c||(location.hash=a?"!"+a:"",e("locationChange"))};var f=function(c){var b=a.contentWindow.document;b.open();b.write("<html><head><title>"+document.title+'</title><script type="text/javascript">var hashValue = "'+c+'";window.top.onIframeHistoryChange(hashValue);\x3c/script></head><body>&nbsp;</body></html>');
b.close()};history.pushState=function(a,b,d){if(!1===e("beforeLocationChange",!0,d))return!1;f(k(d))};history.replaceState=function(c,b,d){if(!1===e("beforeLocationChange",!0,d))return!1;c=k(d);a.contentWindow.hashValue=c};var g=function(){a=document.createElement("iframe");a.src="about:blank";a.style.display="none";document.body.appendChild(a);c=!0;f(k(location.hash.substr(1)));c=!1};p?g():h(window,"load",g)}h(document.documentElement,"click",function(a){a=a||window.event;for(var b=a.target||a.srcElement,
c;b&&"a"!=b.nodeName.toLowerCase();)b=b.parentNode;if(b){if(b=(c=b.getAttribute("href"))&&"#"!=c.substr(0,1)&&!b.getAttribute("target"))b=c.match(l),b=b[1]&&location.protocol!=b[1]||b[2]&&location.hostname!=b[2]?!1:b[2]||b[3]?location.port==b[3]:!0;if(b&&n(c)!=n(window.location))return history.pushState(null,null,n(c)),a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation(),!1}return null});history.initPushState=function(){}};MetaphorJs.pushUrl=function(a){history.pushState(null,
null,a)};MetaphorJs.replaceUrl=function(a){history.replaceState(null,null,a)};MetaphorJs.currentUrl=function(){return q()};history.onBeforeChange=function(a){g.beforeLocationChange.push(a)};history.onChange=function(a){g.locationChange.push(a)}})()})();
